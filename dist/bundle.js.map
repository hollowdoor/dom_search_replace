{"version":3,"file":null,"sources":["../src/index.js"],"sourcesContent":["import domSearch from 'dom-search';\nimport isRegexp from 'is-regexp';\n\nfunction domSearchReplace(doc, pattern, replacement, options){\n    const search = typeof options === 'object' ?  Object.create(options) : {};\n    search.all = typeof search.all === 'boolean' ? search.all : false;\n    search.replaceType = getReplacementType(replacement);\n\n    let result = domSearch(doc, pattern, options);\n\n    if(!result.length){\n        return doc;\n    }\n\n    if(search.replaceType === 'node'){\n        replaceWithNode(result[0], pattern, replacement, search);\n        return doc;\n    }else if(search.replaceType === 'appendTo'){\n        replaceWithAppendTo(result[0], pattern, replacement, search);\n        return doc;\n    }\n\n    replacement = String(replacement);\n\n    if(!search.all){\n        replaceWithText(result[0], pattern, replacement, search);\n        return doc;\n    }\n\n    for(let res of result){\n        replaceWithText(res, pattern, replacement, search);\n    }\n\n    return doc;\n}\n\n\n\nfunction replaceWithText(result, pattern, replacement, search){\n    let str = result.textNode.nodeValue;\n    let parts, collect = '';\n\n    if(sameLength(pattern, str)){\n        result.textNode.nodeValue = replacement;\n        return;\n    }\n\n    if(search.all){\n        parts = str.split(pattern);\n    }else{\n        parts = str.split(pattern, 2);\n    }\n\n    for(let i=0; i<parts.length; i++){\n        collect += parts[i];\n        if(i < parts.length - 1){\n            collect += replacement;\n        }\n    }\n\n    result.textNode.nodeValue = collect;\n}\n\nfunction replaceWithNode(result, pattern, replacement, search){\n    let str = result.textNode.nodeValue;\n\n\n    if(sameLength(pattern, str)){\n        result.parent.replaceChild(replacement, result.textNode);\n        return;\n    }\n\n    let [before, after] = str.split(pattern, 2);\n\n    const frag = document.createDocumentFragment();\n\n    frag.appendChild(document.createTextNode(before));\n    frag.appendChild(replacement);\n    frag.appendChild(document.createTextNode(after));\n\n    result.parent.replaceChild(frag, result.textNode);\n\n}\n\nfunction replaceWithAppendTo(result, pattern, replacement, search){\n    let str = result.textNode.nodeValue;\n    let frag = document.createDocumentFragment();\n\n    if(sameLength(pattern, str)){\n        replacement.appendTo(frag);\n    }else{\n        let [before, after] = str.split(pattern, 2);\n\n        frag.appendChild(document.createTextNode(before));\n        replacement.appendTo(frag);\n        frag.appendChild(document.createTextNode(after));\n    }\n\n    result.parent.replaceChild(frag, result.textNode);\n\n}\n\nfunction getReplacementType(replacement){\n    if(isNode(replacement)){\n        return 'node';\n    }else if(typeof replacement === 'object' && typeof replacement.appendTo === 'function'){\n        return 'appendTo';\n    }\n    return 'none';\n}\n\nfunction sameLength(pattern, str){\n    if(typeof pattern === 'string' && pattern.length === str.length){\n        return true;\n    }else if(isRegexp(pattern)){\n        let match = str.match(pattern);\n        if(match[0].length === str.length){\n            return true;\n        }\n    }\n\n    return false;\n}\n\nfunction isNode(o){\n  return (\n    typeof Node === \"object\" ? o instanceof Node :\n    o && typeof o === \"object\" && typeof o.nodeType === \"number\" && typeof o.nodeName===\"string\"\n  );\n}\n\n\nexport default domSearchReplace;\n\n/*\ngit remote add origin https://github.com/hollowdoor/dom_search_replace.git\ngit push -u origin master\n*/\n"],"names":[],"mappings":"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"}